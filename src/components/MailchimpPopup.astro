---
// Mailchimp Popup Form Component
// This component loads the Mailchimp popup script for static sites

interface Props {
  enabled?: boolean;
}

const { enabled = true } = Astro.props;

// Get Mailchimp configuration from environment variables
const MAILCHIMP_USER_ID = import.meta.env.PUBLIC_MAILCHIMP_USER_ID;
const MAILCHIMP_FORM_ID = import.meta.env.PUBLIC_MAILCHIMP_FORM_ID;
---

{enabled && MAILCHIMP_USER_ID && MAILCHIMP_FORM_ID && (
  <script 
    id="mcjs"
    data-user-id={MAILCHIMP_USER_ID}
    data-form-id={MAILCHIMP_FORM_ID}
  >
    (function() {
      const userId = document.currentScript.dataset.userId;
      const formId = document.currentScript.dataset.formId;
      
      if (!userId || !formId) {
        console.warn('Mailchimp popup configuration missing');
        return;
      }
      
      const script = document.createElement('script');
      script.async = true;
      script.src = `https://chimpstatic.com/mcjs-connected/js/users/${userId}/${formId}.js`;
      
      const firstScript = document.getElementsByTagName('script')[0];
      firstScript.parentNode.insertBefore(script, firstScript);
    })();
  </script>
)}

<!-- 
  To set up Mailchimp popup forms:
  
  1. Go to Mailchimp → Audience → Signup forms → Subscriber pop-up
  2. Design your popup form
  3. Get the script URL which contains your USER_ID and FORM_ID
  4. Add these to your .env file:
     PUBLIC_MAILCHIMP_USER_ID=your_user_id_here
     PUBLIC_MAILCHIMP_FORM_ID=your_form_id_here
  
  The popup will automatically handle:
  - Display rules (timing, pages, frequency)
  - Form submission
  - Success/error messages
  - Mobile responsiveness
  - GDPR compliance
-->