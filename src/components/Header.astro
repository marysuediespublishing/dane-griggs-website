---
import { SITE_TITLE } from '../consts';
import Navigation from './Navigation.astro';
import MobileMenu from './MobileMenu.astro';
import SearchBox from './ui/SearchBox.tsx';
import NewsletterCTA from './ui/NewsletterCTA.tsx';
---

<header data-testid="site-header" class="bg-gradient-to-r from-deep-space-navy to-nebula-purple backdrop-blur-md border-b border-cosmic-rose/20 sticky top-0 z-50 transition-all duration-300">
	<div class="container mx-auto px-4 py-4">
		<nav class="flex items-center justify-between">
			<!-- Author Name/Logo -->
			<div data-testid="author-name" class="flex items-center space-x-3">
				<a href="/" class="group flex items-center space-x-2 transition-all duration-200 hover:-translate-y-0.5">
					<div class="w-8 h-8 bg-gradient-aurora rounded-full flex items-center justify-center">
						<span class="text-solar-white font-bold font-accent text-sm">DG</span>
					</div>
					<span class="text-xl font-bold font-primary text-solar-white group-hover:text-stellar-gold transition-colors">
						{SITE_TITLE}
					</span>
				</a>
			</div>

			<!-- Desktop Navigation -->
			<div class="hidden md:flex items-center space-x-6">
				<Navigation />
				
				<!-- Search -->
				<div class="hidden lg:block">
					<SearchBox client:load />
				</div>
				
				<!-- Newsletter CTA -->
				<NewsletterCTA 
					variant="header" 
					text="Free Books" 
					className="btn-primary text-sm px-3 py-2 ml-3"
					client:load 
				/>
			</div>

			<!-- Mobile Actions -->
			<div class="flex md:hidden items-center space-x-3">
				<!-- Mobile Search Toggle -->
				<button 
					id="mobile-search-toggle"
					class="p-2 text-solar-white hover:text-stellar-gold transition-colors"
					aria-label="Toggle search"
				>
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
					</svg>
				</button>
				
				<!-- Newsletter CTA Mobile -->
				<NewsletterCTA 
					variant="mobile" 
					text="ðŸ“§" 
					className="btn-primary text-sm px-2 py-2"
					client:load 
				/>
				
				<!-- Mobile Menu Toggle -->
				<MobileMenu />
			</div>
		</nav>
		
		<!-- Mobile Search Bar (Hidden by default) -->
		<div id="mobile-search-bar" class="hidden md:hidden mt-4 pb-2">
			<SearchBox client:load mobile={true} />
		</div>
	</div>
	
	<!-- Cosmic header glow effect -->
	<div class="absolute inset-0 bg-gradient-to-r from-cosmic-rose/5 to-stellar-gold/5 pointer-events-none"></div>
</header>

<script>
	// Mobile search toggle functionality
	document.addEventListener('DOMContentLoaded', () => {
		const searchToggle = document.getElementById('mobile-search-toggle');
		const searchBar = document.getElementById('mobile-search-bar');
		
		if (searchToggle && searchBar) {
			searchToggle.addEventListener('click', () => {
				searchBar.classList.toggle('hidden');
				
				// Focus the search input when opened
				if (!searchBar.classList.contains('hidden')) {
					const searchInput = searchBar.querySelector('input');
					if (searchInput) {
						searchInput.focus();
					}
				}
			});
		}
	});
</script>
